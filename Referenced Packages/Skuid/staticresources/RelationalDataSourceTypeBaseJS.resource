!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1770)}({1770:function(e,t,n){"use strict";var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=n(40),o=(i=a)&&i.__esModule?i:{default:i};!function(e){var t=e.$,n=t.each,i=t.extend,a=e.constants,l=e.dataSource,c=a.DISPLAY_TYPES,u=l.core||(l.core={}),d=e.utils,s=d.isString,f=t.Deferred,h=["name"],p="x-sql-dialect";function y(e){var t=e.body;if(t)for(;s(t);)try{t=JSON.parse(t)}catch(e){break}return t}var g={getEntityList:function(e,t){return{url:d.combineUrls(t.dataServiceUrl,"datasources/"+t.id+"/entities"),method:"GET",contentType:"application/json",headers:{}}},getModelMetadata:function(e,t){return{url:d.combineUrls(t.dataServiceUrl,"datasources/"+t.id+"/entities?name="+e.entity),method:"GET",contentType:"application/json",headers:{accept:"application/vnd.skuid-metadata"}}},load:function(e,t){return{url:d.combineUrls(t.dataServiceUrl,"datasources/"+t.id+"/load"),method:"POST",contentType:"application/json",body:e}},save:function(e,t){return{url:d.combineUrls(t.dataServiceUrl,"datasources/"+t.id+"/save"),method:"POST",contentType:"application/json",body:e}}};function v(n){for(var i,r={},a=n.getDataSourceType(),l=function(i){return function(r){if(n.proxyHost&&n.proxyPort)return function(e,n,i){return o.default.getAPIToken().then(function(r){var a=g[e](n,i);return a.headers=t.extend({},{"x-skuid-options-schemas":!0,Authorization:"Bearer "+r.jwt},a.headers),a})}(i,r,n).then(function(i){return e.ajax.direct(n.createHTTPRequest(i)).then(y).catch(function(e){var n,i=y(e);return i&&t.isPlainObject(i)&&(n=i.message),n||(n=e.status),n})});var l=f(),c=function(t,n,i,r){var a=i.useDataSourceObjects?i.dataServiceUrl:r.remoteEndpoint,o=n?"POST":"GET",l={method:o,url:d.combineUrls(a,t)};return"POST"===o&&(l.body=n,l.contentType="application/json"),l.headers={"x-skuid-data-source":i.name,"x-skuid-options-schemas":!0},r.sendSessionIdAsHeader&&(l.headers["x-skuid-session-id"]=e.utils.userInfo.sessionId),r[p]&&(l.headers[p]=r[p]),l}(i,r,n,a);return e.ajax.direct(n.createHTTPRequest(c)).then(function(e){l.resolve(y(e))},function(e){var n,i=y(e);i&&t.isPlainObject(i)&&(n=i.message),n||(n=e.status),l.reject(n)}),l.promise()}},c=0,u=["load","save","getModelMetadata","getEntityList"];c<u.length;c++)r[i=u[c]]=l(i);return n._remote=r,r}function m(e){var t=e._remote;return t||(t=new v(e)),t}function b(e,t,n){t||(t=n.getDataSource());var i=t.getCachedEntityMetadata(e),r=i&&i.get("nameFields");if(r&&r.length)return r[0]}function F(e){var n=e.idFields;return n&&t.isArray(n)&&1===n.length?n[0]:n}function T(e){var n,i,r,a;e.rel||(e.rel=e.id+"__rel"),e.relationshipName||(e.relationshipName=e.rel),!e.ref&&e.referenceTo&&(n=e.referenceTo)&&n.length&&(i=[],r=[],a={c:"createable",o:"objectName",l:"label",k:"keyPrefix",p:"labelPlural",s:"searchable"},t.each(n,function(e,n){n.o?(i.push(n.o),r.push(n.k),t.each(a,function(e,t){n[t]=n[e],delete n[e]}),n.accessible=!0):(i.push(n.objectName),n.accessible=!0)}),i.length&&(e.ref=i.join(",")),r.length&&(e.refprefix=r.join(",")))}function M(e){return d.grab(e,"referenceTo",0,"keyField")}function S(e){return e&&e.slice(0,-5)}function j(e){return e&&e+"__rel"}function P(e){!function(e){t.each(e,function(e,t){if(!t.fields||!t.fields.length)throw"Error with Model: "+t.id+" - Must have at least one valid field"})}(e),function(e){t.each(e,function(e,n){if(!n.conditions||!n.conditions.length)return delete n.conditions,void delete n.conditionLogic;var i=!1;t.each(n.conditions,function(e,t){t.inactive||(i=!0)}),i||(delete n.conditions,delete n.conditionLogic)})}(e)}function E(e){return d.isString(e)||e.objectName&&e.dataSource}function R(e){n(h,function(t,n){if(!e[n])throw"Missing Required Property Error: "+n}),i(this,e),e.extendedProperties&&(i(!0,this.properties,e.extendedProperties),delete this.extendedProperties),l.DataSourceType.prototype.constructor.call(this,this),delete this.getModelProperties}R.prototype=new l.DataSourceType(!1),R.constructor=R,R.prototype=i(!0,R.prototype,{save:function(e,t){var n=t.dataSource;return n.authenticate().then(function(){return m(n).save(e)})},load:function(e,n){var i=n.dataSource;return i.authenticate().then(function(){var r=!1,a=["conditionLogic","doQuery","groupByMethod","havingLogic","id","objectName","schemaName","orderByClause","offsetPageNumber","offsetPageSize","recordsLimit","type"],o={},l=t.map(e,function(e){var n={};for(var i in e)e.hasOwnProperty(i)&&t.inArray(i,a)>-1&&(d.isUndefined(e[i])||""===e[i]||(n[i]=e[i]));var l=e.fields.filter(function(e){return e.uiOnly});return l.length&&(o[e.id]=l),t.each(["fields","groupByFields"],function(i,r){var a,o=e[r];o&&o.length&&(a=n[r]=[],t.each(o,function(e,n){var i;if(n.uiOnly)return!0;"childRelationship"===n.type?(i={id:n.id,type:n.type,anchorField:n.anchorField,keyField:n.keyField,childObject:n.childObject},t.each(["recordsLimit","orderByClause","subConditionLogic"],function(e,t){n.hasOwnProperty(t)&&null!==n[t]&&void 0!==n[t]&&(i[t]=n[t])}),n.subConditions&&(i.subConditions=[],n.subConditions.length&&t.each(n.subConditions,function(e,t){var n={};for(var r in t)t.hasOwnProperty(r)&&null!==t[r]&&void 0!==t[r]&&(n[r]=t[r]);i.subConditions.push(n)})),n.subFields&&(i.subFields=[],n.subFields.length&&t.each(n.subFields,function(e,t){var r={id:t.id};void 0!==n.query&&null!==n.query&&(r.query=r.query),i.subFields.push(r)}))):(i={id:n.id},t.each(["name","function","query"],function(e,t){n.hasOwnProperty(t)&&null!==n[t]&&(i[t]=n[t])})),a.push(i)}))}),t.each(["conditions","havings"],function(i,r){var a,o=e[r];o&&o.length&&(a=n[r]=[],t.each(o,function(n,i){var r=t.extend({},i);for(var o in r)null===r[o]&&delete r[o];t.each(r.subConditions,function(t,n){var i=e.getField(n.field);["INTEGER","DOUBLE","CURRENCY"].indexOf(i.displaytype)>-1&&(n.operator="=")}),a.push(r)}))}),e.needsMetadataLoad&&(r=!0),n});P(l);var c=!n||n.loadAllMetadata||r;return m(i).load({operationModels:l,options:{excludeMetadata:!c}}).then(function(e){var n,r,a=f();return t.isArray(e)?a.resolve(e):e&&e.models?((n=e.metadata)&&d.size(n)&&t.each(n,function(e,t){i.cacheEntityMetadata(e,t)}),Object.keys(o).length&&(e.models=(r=o,e.models.map(function(e){return e.fields&&r[e.id]&&(e.fields=e.fields.concat(r[e.id])),e}))),a.resolve(e.models)):a.reject("Invalid Response Format"),a.promise()})})},getRowId:function(e,n){var i,r=F(n),a={},o=!1;return t.isArray(r)?(r.length<=0&&(o=!0),r.forEach(function(t){var i=n.getFieldValue(e,t,!0);d.isUndefined(i)||null===i?o=!0:a[t]=i})):(i=n.getFieldValue(e,r,!0),d.isUndefined(i)||null===i?o=!0:a[r]=i),o?d.generateUniqueId():JSON.stringify(a)},getChildIdFromRow:function(e,t,n){var i=e.getIdFieldForChildRelationship(n),r=t[i],a=null;if(i&&r){var o={};o[i]=r,a=d.encodeHTML(JSON.stringify(o))}return a},getReferenceHandler:function(){return{getReferenceValue:function(e,t){return e[M(t)]},processReferenceLookupModel:function(e,t,n){var i=M(t.metadata),r=b(n,null,e);e.objectName=n,e.fields||(e.fields=[]),e.fields.push({id:i}),r&&!e.getField(r)&&e.fields.push({id:r})},getRowFromReferenceValue:function(e,t,n){var i=M(n),r=e.getRows([{field:i,value:t}]);return r&&r.length?r[0]:{}}}},getRowName:function(e,t,n){return t.getFieldValue(e,b(t.objectName,n,t),!0)},getNameField:b,getIdField:F,getIdFieldForChildRelationship:function(e,t){return F(e.fieldsMap[t])},initialize:function(e){if(e.fields&&e.fields.length){var n=e.getDataSource&&e.getDataSource(),i=n&&n.getCachedEntityMetadata(e.objectName);i&&(t.each(e.fields,function(n,r){!function e(n,i,r,a){if(i){var o,l,u,d,s,f,h=i.split("."),p=a.getDataSource&&a.getDataSource();if("childRelationship"===n.type)(d=n.referenceTo&&n.referenceTo.length&&n.referenceTo[0])&&(s=p&&p.getCachedEntityMetadata(d.o),n.idFields=s.get("idFields"),(f=n.subFields)&&t.each(f,function(t,n){e(n,n.id,s,a)}));else if(1===h.length){if(o=r&&r.getField&&r.getField(i)){l=a.getOverrideableFieldMetadata(n);var y=n.id,g=n.name;t.extend(!0,n,o),y&&(n.id=y),g&&(n.name=g),l&&t.each(l,function(e,t){n[e]=t})}n&&n.displaytype===c.REFERENCE&&T(n)}else i=S(i=h.shift()),(o=r&&i&&r.getField&&r.getField(i))&&((u=o.referenceTo)&&1===u.length?r=p&&p.getCachedEntityMetadata(u[0].objectName||u[0].o):u&&u.length>1&&(r=p&&p.getCachedEntityMetadata("Name")),r&&e(n,h.join("."),r,a)),n.required=n.createable=n.editable=!1}}(r,r.id,i,e)}),t.each(i.get(["label","labelPlural"]),function(t,n){e.hasOwnProperty(t)||(e[t]=n)}),t.each(i.get(["accessible","createable","updateable","deleteable","idFields"]),function(t,n){e[t]=n}))}return(!e.idFields||e.idFields&&!e.idFields.length)&&(e.updateable=!1,e.deleteable=!1),e.data instanceof Array||(e.data=[e.data]),e},getEntityList:function(e){var n=e.dataSource;return n._entityListCache?f().resolve(n._entityListCache):n.authenticate().then(function(){return m(n).getEntityList()}).then(function(e){return n._entityListCache=e.map(function(e){return t.isPlainObject(e)?{label:e.label,value:e.name}:e}),n._entityListCache})},handleDefaultReferenceFieldValue:function(e,n,i,a,o){var l=a.rel,c=n.value,u=d.getNameField(a.ref,i.dataSource),s=n.nameFieldValue||!1;if(!s){var f=d.getFieldReference(n.field,a,i.dataSource);t.each(o,function(e,t){t===n||t.field!==f||t.inactive||!t.value||n.operator&&"="!==n.operator||(s=t.value)})}var h,p={};s&&("object"===(void 0===s?"undefined":r(s))?h=s:(h={})[u]=s,p[l]=h),p[n.field]=c,i.updateRow(e,p)},getReferenceFieldRelatedData:function(n,i,r,a,o){var l,c=n.id,u=j(c);if(void 0===o[u]){if(t.each(a.data,function(){if(this[c]&&this[c]===i&&a.getFieldValue(this,u))return l=a.getFieldValue(this,u,!0),!1}),!l){var d=a.dataSource&&a.dataSource.name,s=n.referenceTo,f=[],h=[];s&&s.length&&t.each(s,function(){f.push(this),h.push(this.objectName)}),t.each(e.model.getModelsByDataSource(d),function(){var e=this,n=[];if(e!==a&&-1!==h.indexOf(e.objectName))return t.each(this.fields,function(){var e=this;t.each(f,function(t,i){i.keyField===e.id&&n.push(e)})}),n.length&&t.each(e.getRows(),function(){var r=this;if(t.each(n,function(){if(e.getFieldValue(r,this.id,!0)===i)return l=r,!1}),l)return!1}),!l&&void 0})}return l}},buildEntityMetadataRequest:function(e){var t=e.targetEntity;return!t&&e.model&&e.model.attr&&(t=e.model.attr("sobject")),{objectName:t}},getEntityMetadataLoadingMessageFromBreadcrumb:function(e){return"Loading metadata for table "+e.endsobject+"..."},getEntityMetadataCacheKey:function(e){return e.objectName},getEntityMetadata:function(e){var n=e.entities,i=e.dataSource;return function(e){if(e){if(t.isArray(e)){var n=!0;return t.each(e,function(){if(!E(this))return n=!1,!1}),n}if(t.isPlainObject(e))return E(e);if(d.isString(e))return!0}return!1}(n)?i.authenticate().then(function(){var e=t.map(n,function(e){var n=s(e)?e:e.objectName,r={entity:n,loadChildRelationships:!0,loadPicklistValues:!1};return n?(e&&e.fields&&e.fields.length&&(r.fieldsToLoad=e.fields.join(",")),m(i).getModelMetadata(r).then(function(e){return t.isArray(e)&&(e=e[0]),e.fields&&e.fields.length&&t.each(e.fields,function(e,n){var r=t.map(n.referenceTo,function(e){return e.objectName}).filter(function(e){return!(e in i.getCachedEntityMetadata())}),a=t.map(n.childRelations,function(e){return e.childObject}).filter(function(e){return!(e in i.getCachedEntityMetadata())});r.concat(a).length>0&&i.getEntityMetadata({entities:r,dataSource:i,ignoreMetadataOverrides:!0}).then(function(e){i.cacheEntityMetadata(i.getEntityMetadataCacheKey(e),e)}),T(n)}),e})):f().reject("No Table Name provided")});return t.when.all(e).catch(function(e){return f().reject(e&&e.length?e.join(","):"")})}):f().reject("Invalid Model configuration. Metadata could not be retrieved.")},getModelProperties:function(t,n){var i=e.builder.core,r=t.state,a=i.getUnsavedChangesWarningProperty({component:t}),o=i.getCoreModelBasicProperties({component:t,propViewer:n}),l=[];return o.push({id:"sobject",type:"sobject",dataSourceTypeName:this.name,dataSourceName:r.attr("datasource"),label:"Entity Name",onChange:function(e){if(e&&(!r.attr("label")||!r.attr("labelplural"))){var n=d.capitalizeFirst(e.split(".").pop());r.attr("label")||r.attr("label",n),r.attr("labelplural")||r.attr("labelplural",n+(d.endsWith(n,"s")?"":"s")),t.save()}}}),o.push(i.getModelTypeProperty({component:t}),i.getModelQueryOnPageLoadProperty({component:t,propViewer:n}),i.getModelLimitProperty(),i.getModelOrderByProperty(),i.getCreateDefaultRowProperty(),i.getModelNameFieldProperty()),a&&l.push(a),Array.prototype.push.apply(l,i.getModelLabelProperties()),[{name:"Basic",props:o},{name:"Advanced",props:l}]},getReferenceFieldNameFromRelationshipField:S,getReferenceFieldRelationshipName:j,joinFieldDisplayTypeFilter:function(e){if(e)return!0},properties:{composer:{supports:{childRelationships:!0},canFieldsBeSelected:function(e){return!!e.breadcrumb.endsobject||"Select an entity to use for this Model"}},batchableEntityRequests:!0,serverSideModelMerge:!0,canAutoGenerateConditionsFromFields:!0,canConditionsBeGrouped:!0,validConditionTypes:["blank","fieldvalue","join","modelmerge","multiple","param","userinfo"]},searchableDisplayTypes:{INTEGER:1,DOUBLE:1,CURRENCY:1,ID:1,STRING:1,TEXT:1,EMAIL:1,PICKLIST:1,MULTIPICKLIST:1,COMBOBOX:1,PHONE:1,URL:1,REFERENCE:1,TEXTAREA:1}}),i(u,{RelationalDataSourceTypeBase:R})}(skuid)},40:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"refreshAPIToken",value:function(){var e=this;return skuid.platform.services.getToken().then(function(t){var n=t.token,i=e.extractJWTPayload(n).exp;return e.apiToken={expiration:i,jwt:n}})}},{key:"extractJWTPayload",value:function(e){var t=e.split(".");if(3!=t.length)throw new Error("JWT not formatted correctly");return JSON.parse(atob(t[1]))}},{key:"getAPIToken",value:function(){var e=this.apiToken;return e&&this.isValid(e)?skuid.utils.resolve(e):this.refreshAPIToken()}},{key:"isValid",value:function(e){var t=void 0;return(t=skuid.utils.isString(e)?this.extractJWTPayload(e).exp:e.expiration)&&t>Date.now()/1e3}}]),e}();t.default=new r}});